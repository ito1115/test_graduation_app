<div class="container">
  <div class="header">
    <h1><%= @book.title %></h1>
    <div class="actions">
      <%= link_to "Back to Books", books_path, class: "btn btn-secondary" %>
      <%= link_to "Edit", edit_book_path(@book), class: "btn btn-primary" %>
      <%= link_to "Delete", @book, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-danger" %>
    </div>
  </div>

  <div class="book-detail">
    <div class="book-image">
      <% if @book.image_url.present? %>
        <img src="<%= @book.image_url %>" alt="<%= @book.title %>" class="book-cover">
      <% else %>
        <div class="no-image">No Image Available</div>
      <% end %>
    </div>

    <div class="book-info">
      <div class="info-row">
        <label>Title:</label>
        <span><%= @book.title %></span>
      </div>

      <div class="info-row">
        <label>購入理由:</label>
        <span><%= @book.purchase_reason.present? ? @book.purchase_reason : "未登録" %></span>
      </div>

      <div class="info-row">
        <label>購入日:</label>
        <span><%= @book.purchase_date.present? ? @book.purchase_date.strftime("%Y年%m月%d日") : "未登録" %></span>
      </div>

      <!-- Reading Status Section -->
      <div class="reading-status-section">
        <div class="current-status">
          <label>読書ステータス:</label>
          <div class="status-info">
            <span class="status-badge status-<%= @book.reading_status || 'wish' %>">
              <%= (@book.reading_status || 'wish').humanize %>
            </span>
            <% if @book.reading_status && @book.send("#{@book.reading_status}_date") %>
              <small class="status-date">
                (<%= @book.send("#{@book.reading_status}_date").strftime("%Y年%m月%d日") %>)
              </small>
            <% end %>
          </div>
        </div>
        
        <!-- Status Change Controls -->
        <div class="status-controls">
          <label>ステータス変更:</label>
          <div class="status-buttons">
            <% if @book.reading_status != 'wish' %>
              <%= link_to "読みたい", 
                  book_path(@book, book: { reading_status: 'wish' }), 
                  data: { turbo_method: :patch },
                  class: "btn btn-sm btn-outline-primary" %>
            <% end %>
            
            <% if @book.reading_status != 'tsundoku' %>
              <%= link_to "積読", 
                  book_path(@book, book: { reading_status: 'tsundoku' }), 
                  data: { turbo_method: :patch },
                  class: "btn btn-sm btn-outline-warning" %>
            <% end %>
            
            <% if @book.reading_status != 'completed' %>
              <%= link_to "読了", 
                  book_path(@book, book: { reading_status: 'completed' }), 
                  data: { turbo_method: :patch },
                  class: "btn btn-sm btn-outline-success" %>
            <% end %>
          </div>
        </div>
      </div>

      <% if @book.author.present? %>
        <div class="info-row">
          <label>Author:</label>
          <span><%= @book.author %></span>
        </div>
      <% end %>

      <% if @book.publisher.present? %>
        <div class="info-row">
          <label>Publisher:</label>
          <span><%= @book.publisher %></span>
        </div>
      <% end %>

      <% if @book.published_date.present? %>
        <div class="info-row">
          <label>Published Date:</label>
          <span><%= @book.published_date %></span>
        </div>
      <% end %>

      <% if @book.primary_isbn %>
        <div class="info-row">
          <label>ISBN:</label>
          <span><%= @book.primary_isbn %></span>
        </div>
      <% end %>

      <% if @book.google_books_id.present? %>
        <div class="info-row">
          <label>Google Books ID:</label>
          <span><%= @book.google_books_id %></span>
        </div>
        <div class="info-row">
          <%= link_to "Refresh from Google Books", refresh_from_google_books_book_path(@book), data: { turbo_method: :patch }, class: "btn btn-outline-primary" %>
        </div>
      <% end %>

      <% if @book.description.present? %>
        <div class="info-row description">
          <label>Description:</label>
          <p><%= simple_format(@book.description) %></p>
        </div>
      <% end %>

      <div class="info-row">
        <label>Added:</label>
        <span><%= @book.created_at.strftime("%Y-%m-%d %H:%M") %></span>
      </div>

      <% if @book.updated_at != @book.created_at %>
        <div class="info-row">
          <label>Last Updated:</label>
          <span><%= @book.updated_at.strftime("%Y-%m-%d %H:%M") %></span>
        </div>
      <% end %>
    </div>
  </div>
</div>